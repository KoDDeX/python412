<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TODO Лист</title>
    <!-- Подключение Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
      crossorigin="anonymous"
    />

    <style>
      .task {
        margin: 5px;
        padding: 5px;
        background-color: #eae0e0;
        cursor: pointer;
      }

      .done {
        text-decoration: line-through;
        background-color: #e0eae1;
      }

      #completed-tasks {
        margin-top: 20px;
        display: none;
      }

      button {
        margin-left: 10px;
        /* оформление  */
        border: 1px solid #000;
        border-radius: 5px;
        background-color: #eae0e0;
        cursor: pointer;
      }
      button:hover {
        background-color: #e0eae1;
        box-shadow: 0 0 5px #000;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <!-- Строка для двух колонок -->
      <div class="row">
        <!-- Колонка для больших экранов 6, для маленьких 12 -->
        <div class="col-lg-7 col-12">
          <div class="p-3 border bg-light">
            <section>
              <h1>Детальное задание для создания To-Do List</h1>
              <ol>
                <li>
                  <strong>Создание базового HTML-документа:</strong>
                  <ul>
                    <li>Объявите тип документа для HTML5.</li>
                    <li>Укажите язык содержимого страницы как русский.</li>
                    <li>
                      В разделе head укажите, что страница должна использовать
                      кодировку UTF-8.
                    </li>
                    <li>Добавьте название вашего документа в теге title.</li>
                  </ul>
                </li>
                <li>
                  <strong>Добавление стилей CSS внутри документа:</strong>
                  <ul>
                    <li>
                      Создайте CSS правила для стилизации элементов страницы в
                      теге style.
                    </li>
                    <li>
                      Опишите внешний вид элементов, которые будут отображать
                      задачи.
                    </li>
                    <li>
                      Установите стиль <code>.done</code> для выполненных задач.
                    </li>
                    <li>Установите стиль <code>.task</code> для задач.</li>
                    <li>
                      Скройте раздел <code>#completed-tasks</code> с
                      выполненными задачами, когда он пуст используя
                      <code>display: none;</code>
                    </li>
                  </ul>
                </li>
                <li>
                  <strong>Разметка контента страницы:</strong>
                  <ul>
                    <li>
                      Поместите заголовок второго уровня
                      <code>h2 - Активные задачи</code> перед областью для
                      задач.
                    </li>

                    <li>
                      Подготовьте контейнер для задач.
                      <code>id - task-list</code>
                    </li>
                    <li>
                      Разместите поле для ввода задачи
                      <code>input type="text" id="task-input"</code> и кнопку
                      <code>button id="add-task-btn"</code> для добавления
                      задачи.
                    </li>
                    <li>
                      Поместите заголовок второго уровня
                      <code>h2 - Выполненные задачи</code> перед областью для
                      выполненных задач.
                    </li>
                    <li>
                      Подготовьте контейнер для выполненных задач.
                      <code>id - completed-tasks</code>
                    </li>
                  </ul>
                </li>
                <li>
                  <strong>Написание логики на JavaScript:</strong>
                  <ul>
                    <li>
                      Создайте функции для управления поведением to-do листа в
                      блоке script.
                    </li>
                    <li>Реализуйте функцию для добавления новой задачи.</li>
                    <li>
                      Проверьте, что поле ввода не пустое, прежде чем добавлять
                      задачу.
                    </li>
                    <li>
                      Добавьте функцию для кнопки "Удалить", которая будет
                      перемещать задачу в список выполненных.
                    </li>
                  </ul>
                </li>
                <li>
                  <strong>Управление отображением выполненных задач:</strong>
                  <ul>
                    <li>
                      Реализуйте функцию, которая контролирует видимость раздела
                      с выполненными задачами.
                    </li>
                  </ul>
                </li>
                <li>
                  <strong>Привязка событий:</strong>
                  <ul>
                    <li>Настройте обработчик события на кнопку "Добавить".</li>
                    <li>
                      Очистите поле ввода и обновите видимость выполненных задач
                      после добавления задачи.
                    </li>
                  </ul>
                </li>
                <li>
                  <strong>Тестирование функциональности:</strong>
                  <ul>
                    <li>
                      Проверьте, что добавление, удаление задач и отображение
                      раздела выполненных задач работают корректно.
                    </li>
                    <li>
                      Убедитесь, что интерфейс корректно отображается на разных
                      устройствах.
                    </li>
                  </ul>
                </li>
              </ol>
            </section>
          </div>
        </div>
        <!-- Колонка для больших экранов 6, для маленьких 12 -->
        <!-- Работу выполняем внутри  div class="p-3 border bg-light-->
        <div class="col-lg-5 col-12">
          <!-- p-3 - отступы по краям, border - граница, bg-light - фоновый цвет, rounded - скругление углов -->
          <div class="p-3 border bg-light">
            <h2>Активные задачи</h2>
            <div id="task-list"></div>
            <!-- BS5 class form-control -->
            <input type="text" id="task-input" placeholder="Введите задачу" />
            <!-- BS5 class btn btn-dark -->
            <button id="add-task-btn" onclick="addTask()">Добавить</button>

            <h2>Выполненные задачи</h2>
            <div id="completed-tasks"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Подключение Bootstrap Bundle JS (включает Popper) -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <script>
      // Объект для хранения данных о задачах
      let todoData = {
        activeTasks: [],
        completedTasks: [],
      };

      // Функция для получения элемента DOM по id
      function getElement(id) {
        return document.getElementById(id);
      }

      // Функция для создания нового элемента с заданным текстом и классом
      function createElementWithText(tag, text, className) {
        const element = document.createElement(tag);
        element.textContent = text;
        if (className) element.classList.add(className);
        return element;
      }

      // Функция для добавления дочернего элемента к родительскому
      function appendChildElement(parent, child) {
        parent.appendChild(child);
      }

      // Функция для проверки, является ли строка пустой после удаления пробелов
      function isEmptyString(str) {
        return str.trim() === "";
      }

      // Функция для отображения предупреждения
      function showAlert(message) {
        alert(message);
      }

      // Функция для очистки значения поля ввода
      function clearInput(input) {
        input.value = "";
      }

      // Функция для создания кнопки удаления задачи
      function createDeleteButton(taskDiv) {
        const deleteBtn = createElementWithText("button", "Удалить");
        deleteBtn.onclick = () => moveTaskToCompleted(taskDiv);
        return deleteBtn;
      }

      // Функция для перемещения задачи в список выполненных
      function moveTaskToCompleted(taskDiv) {
        const taskId = taskDiv.getAttribute("data-id");
        const taskIndex = todoData.activeTasks.findIndex(
          (task) => task.id === taskId
        );
        if (taskIndex !== -1) {
          const task = todoData.activeTasks.splice(taskIndex, 1)[0];
          task.status = "completed";
          todoData.completedTasks.push(task);
          taskDiv.classList.add("done");
          const completedTasks = getElement("completed-tasks");
          appendChildElement(completedTasks, taskDiv);
          taskDiv.querySelector("button").remove();
          updateCompletedTasksVisibility();
          saveTodoData();
        }
      }

      // Функция для обновления видимости блока с выполненными задачами
      function updateCompletedTasksVisibility() {
        const completedTasks = getElement("completed-tasks");
        completedTasks.style.display =
          completedTasks.children.length > 0 ? "block" : "none";
      }

      // Функция для создания новой задачи
      function createNewTask(taskText, id) {
        const taskDiv = createElementWithText("div", taskText, "task");
        taskDiv.setAttribute("data-id", id);
        const deleteBtn = createDeleteButton(taskDiv);
        appendChildElement(taskDiv, deleteBtn);
        return taskDiv;
      }

      // Основная функция для добавления новой задачи
      function addTask() {
        const input = getElement("task-input");
        const taskList = getElement("task-list");
        const taskText = input.value;

        if (isEmptyString(taskText)) {
          showAlert("Пожалуйста, введите задачу!");
          return;
        }

        const id = Date.now().toString();
        const newTask = createNewTask(taskText, id);
        appendChildElement(taskList, newTask);
        todoData.activeTasks.push({ id, text: taskText, status: "active" });
        clearInput(input);
        updateCompletedTasksVisibility();
        saveTodoData();
      }

      // Функция для сохранения данных в LocalStorage
      function saveTodoData() {
        try {
          localStorage.setItem("todoData", JSON.stringify(todoData));
        } catch (error) {
          console.error("Ошибка при сохранении данных:", error);
        }
      }

      // Функция для загрузки данных из LocalStorage
      function loadTodoData() {
        try {
          const savedData = localStorage.getItem("todoData");
          if (savedData) {
            todoData = JSON.parse(savedData);
          }
        } catch (error) {
          console.error("Ошибка при загрузке данных:", error);
          todoData = { activeTasks: [], completedTasks: [] };
        }
      }

      // Функция для отрисовки задач
      function renderTasks() {
        const taskList = getElement("task-list");
        const completedTasks = getElement("completed-tasks");
        taskList.innerHTML = "";
        completedTasks.innerHTML = "";

        todoData.activeTasks.forEach((task) => {
          const taskDiv = createNewTask(task.text, task.id);
          appendChildElement(taskList, taskDiv);
        });

        todoData.completedTasks.forEach((task) => {
          const taskDiv = createElementWithText("div", task.text, "task done");
          taskDiv.setAttribute("data-id", task.id);
          appendChildElement(completedTasks, taskDiv);
        });

        updateCompletedTasksVisibility();
      }

      // Инициализация обработчика события для кнопки добавления задачи
      function initAddTaskButton() {
        const addTaskBtn = getElement("add-task-btn");
        addTaskBtn.onclick = addTask;
      }

      // Функция инициализации приложения
      function initApp() {
        loadTodoData();
        renderTasks();
        initAddTaskButton();
        updateCompletedTasksVisibility();
      }

      // Обработчик события изменения хранилища
      window.addEventListener("storage", (event) => {
        if (event.key === "todoData") {
          loadTodoData();
          renderTasks();
        }
      });

      // Запуск инициализации приложения после загрузки DOM
      document.addEventListener("DOMContentLoaded", initApp);
    </script>
  </body>
</html>
